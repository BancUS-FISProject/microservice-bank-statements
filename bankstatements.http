# Pruebas API Bank Statements
# Microservicio de Estados de Cuenta Bancarios

@baseUrl = http://localhost:3000/v1/bankstatements
@testIban = ES1111111111111111111111
@testId = 695ef392f56ad40f282ba740
# Token JWT de ejemplo - reemplazar con token válido del login
@token = Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYmFuIjoiRVMxMTExMTExMTExMTExMTExMTExMTExIiwibmFtZSI6IlVzdWFyaW8gVGVzdCIsImVtYWlsIjoidGVzdEB0ZXN0LmNvbSJ9.test

### Health Check
GET http://localhost:3000/health

### 1. GET /by-iban/:iban - Listar meses disponibles por IBAN
GET {{baseUrl}}/by-iban/{{testIban}}
Accept: application/json
Authorization: {{token}}

### 2. GET /by-iban?iban&month - Obtener statement por IBAN y mes específico
GET {{baseUrl}}/by-iban?iban={{testIban}}&month=2025-12
Accept: application/json
Authorization: {{token}}

### 3. Obtener statement por ID de MongoDB
GET {{baseUrl}}/{{testId}}
Accept: application/json

### 4. Generar statements (bulk) - Sin body usa scheduler automático
POST {{baseUrl}}/generate
Content-Type: application/json

### 5. Generar statement manual (con transacciones)
POST {{baseUrl}}/generate
Content-Type: application/json
Authorization: {{token}}

{
  "accountId": "ES2222222222222222222222",
  "month": 1,
  "year": 2025,
  "transactions": [
    {
      "date": "2025-01-15T10:30:00.000Z",
      "amount": 250.50,
      "currency": "EUR",
      "description": "Transferencia recibida"
    },
    {
      "date": "2025-01-20T14:00:00.000Z",
      "amount": -100.00,
      "currency": "EUR",
      "description": "Pago de servicios"
    }
  ]
}

### 6. Eliminar statement por ID de MongoDB
DELETE {{baseUrl}}/{{testId}}

### 7. Actualizar statement por ID de MongoDB
PUT {{baseUrl}}/{{testId}}
Content-Type: application/json

{
  "transactions": [
    {
      "date": "2025-10-05T12:00:00.000Z",
      "amount": 500,
      "currency": "EUR",
      "description": "Pago recibido"
    },
    {
      "date": "2025-10-15T14:30:00.000Z",
      "amount": -150.75,
      "currency": "EUR",
      "description": "Compra online"
    }
  ],
  "total_incoming": 500,
  "total_outgoing": 150.75
}

### 8. POST /generate-current - Generar estado de cuenta del mes actual desde transacciones
# Este es el endpoint que usa el botón "Simular" del frontend
# Consume GET /v1/transactions/user/{iban} del microservicio
# Filtra transacciones del mes actual y crea un nuevo statement
# Persiste en la base de datos con el esquema BankStatementSchema
POST {{baseUrl}}/generate-current
Content-Type: application/json
Authorization: {{token}}

{
  "iban": "{{testIban}}"
}
